<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cape Town Property Investment</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23007847' width='100' height='100'/><polygon fill='%23FFB81C' points='0,50 30,30 30,70'/><polygon fill='%23000' points='0,35 20,50 0,65'/><rect fill='%23DE3831' x='30' y='0' width='70' height='33'/><rect fill='%23002395' x='30' y='67' width='70' height='33'/><rect fill='%23FFF' x='30' y='33' width='70' height='34'/></svg>">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <h1>Cape Town Property Investment</h1>
    <span class="header-subtitle">Non-Resident Investor Analysis</span>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">
    <!-- LEFT SIDEBAR: Map -->
    <aside class="map-sidebar">
      <div class="map-container">
        <div id="map"></div>
      </div>
      <div class="legend">
        <h4>Price per m² (ZAR)</h4>
        <div class="legend-item"><span class="color-box" style="background:#2ECC71"></span><span>R24k - R35k</span></div>
        <div class="legend-item"><span class="color-box" style="background:#F1C40F"></span><span>R35k - R50k</span></div>
        <div class="legend-item"><span class="color-box" style="background:#F39C12"></span><span>R50k - R70k</span></div>
        <div class="legend-item"><span class="color-box" style="background:#E67E22"></span><span>R70k - R100k</span></div>
        <div class="legend-item"><span class="color-box" style="background:#E74C3C"></span><span>R100k - R140k</span></div>
        <div class="legend-item"><span class="color-box" style="background:#8E44AD"></span><span>R140k+</span></div>
      </div>
      <div class="map-instructions">
        Click a zone to view listings
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content-area">
      <!-- TABS -->
      <div class="main-tabs">
        <button class="main-tab active" onclick="showTab('zone')">Selected Zone</button>
        <button class="main-tab" onclick="showTab('rankings')">Top 5 Rankings</button>
        <button class="main-tab" onclick="showTab('all-listings')">All Listings</button>
      </div>

      <!-- TAB: Selected Zone -->
      <section id="tab-zone" class="tab-content active">
        <div class="zone-header">
          <h2 id="zone-title">Select a zone on the map</h2>
          <div id="zone-badges" class="zone-badges"></div>
        </div>

        <div id="zone-stats" class="zone-stats">
          <p class="zone-instruction">Click on a neighborhood in the map to see price data, rental yields, and available listings.</p>
        </div>

        <div id="zone-price-info" class="zone-price-grid"></div>

        <div id="zone-listings" class="listings-grid"></div>
      </section>

      <!-- TAB: Rankings -->
      <section id="tab-rankings" class="tab-content">
        <h2>Investment Rankings</h2>
        <p class="section-subtitle">Top 5 neighborhoods by net yield (35m² apartment)</p>

        <div class="rankings-grid">
          <div class="ranking-card">
            <h4>Long-Term + Resale</h4>
            <ol id="rank-lt-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Long-Term + New</h4>
            <ol id="rank-lt-new" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + Resale</h4>
            <ol id="rank-ab-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + New</h4>
            <ol id="rank-ab-new" class="ranking-list"></ol>
          </div>
        </div>

        <div class="rankings-note">
          <strong>Note:</strong> Net yield includes all costs (levy, rates, insurance, fees, management).
          Airbnb assumes average occupancy - top performers can achieve higher yields.
        </div>
      </section>

      <!-- TAB: All Listings -->
      <section id="tab-all-listings" class="tab-content">
        <h2>All Available Listings</h2>
        <p class="section-subtitle">22 properties from Private Property</p>

        <div class="listings-filters">
          <div class="filter-group">
            <label>Zone</label>
            <select id="filter-zone" onchange="filterListings()">
              <option value="all">All Zones</option>
              <option value="table_view">Table View</option>
              <option value="milnerton">Milnerton</option>
              <option value="big_bay">Big Bay</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Max Price</label>
            <select id="filter-price" onchange="filterListings()">
              <option value="999999999">Any</option>
              <option value="1000000">Under R1M</option>
              <option value="1250000">Under R1.25M</option>
              <option value="1500000">Under R1.5M</option>
              <option value="2000000">Under R2M</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Bedrooms</label>
            <select id="filter-beds" onchange="filterListings()">
              <option value="all">Any</option>
              <option value="1">1 Bed</option>
              <option value="2">2 Bed</option>
            </select>
          </div>
        </div>

        <div id="all-listings-grid" class="listings-grid"></div>
      </section>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    Data: The Africanvestor, Private Property, Lightstone, Airbnb (Feb 2026)
  </footer>

  <!-- BP Modal (unchanged) -->
  <div id="bp-modal" class="bp-modal">
    <div class="bp-modal-content">
      <button class="bp-close" onclick="closeBPModal()">&times;</button>

      <div class="bp-header">
        <h2 id="bp-title">Business Plan</h2>
        <span id="bp-zone" class="bp-zone-badge"></span>
      </div>

      <div class="bp-inputs">
        <div class="bp-input-group">
          <label for="bp-size">Apartment Size (m²)</label>
          <input type="number" id="bp-size" value="35" min="15" max="200" step="5">
        </div>
        <div class="bp-input-group">
          <label>Purchase Type</label>
          <div class="bp-toggle">
            <button id="btn-resale" class="bp-toggle-btn active" onclick="setPurchaseType('resale')">Resale</button>
            <button id="btn-new" class="bp-toggle-btn" onclick="setPurchaseType('new')">New Dev</button>
          </div>
        </div>
      </div>

      <div class="bp-summary">
        <div class="bp-summary-item">
          <span class="bp-summary-label">Purchase Price</span>
          <span id="bp-purchase-price" class="bp-summary-value">-</span>
        </div>
        <div class="bp-summary-item">
          <span class="bp-summary-label">Price per m²</span>
          <span id="bp-price-sqm" class="bp-summary-value">-</span>
        </div>
      </div>

      <div class="bp-comparison">
        <div class="bp-column bp-longterm">
          <div class="bp-column-header">
            <h3>Long-Term Rental</h3>
          </div>
          <div class="bp-metrics">
            <div class="bp-metric">
              <span class="bp-metric-label">Monthly Rent</span>
              <span id="bp-lt-rent" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric">
              <span class="bp-metric-label">Annual Revenue</span>
              <span id="bp-lt-annual" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric">
              <span class="bp-metric-label">Occupancy</span>
              <span id="bp-lt-occupancy" class="bp-metric-value">95%</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Body Corporate</span>
              <span id="bp-lt-levy" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Rates & Taxes</span>
              <span id="bp-lt-rates" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Insurance</span>
              <span id="bp-lt-insurance" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Maintenance (5%)</span>
              <span id="bp-lt-maintenance" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-highlight">
              <span class="bp-metric-label">Net Annual Income</span>
              <span id="bp-lt-net" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric bp-metric-yield">
              <span class="bp-metric-label">Gross Yield</span>
              <span id="bp-lt-gross-yield" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric bp-metric-yield">
              <span class="bp-metric-label">Net Yield</span>
              <span id="bp-lt-net-yield" class="bp-metric-value highlight">-</span>
            </div>
          </div>
        </div>

        <div class="bp-column bp-airbnb">
          <div class="bp-column-header">
            <h3>Airbnb</h3>
          </div>
          <div class="bp-metrics">
            <div class="bp-metric">
              <span class="bp-metric-label">Nightly Rate</span>
              <span id="bp-ab-nightly" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric">
              <span class="bp-metric-label">Annual Revenue</span>
              <span id="bp-ab-annual" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric">
              <span class="bp-metric-label">Occupancy</span>
              <span id="bp-ab-occupancy" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Airbnb Fees (15%)</span>
              <span id="bp-ab-fees" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Cleaning (R400/turn)</span>
              <span id="bp-ab-cleaning" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Utilities & Supplies</span>
              <span id="bp-ab-utilities" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-sub">
              <span class="bp-metric-label">Management (20%)</span>
              <span id="bp-ab-management" class="bp-metric-value expense">-</span>
            </div>
            <div class="bp-metric bp-metric-highlight">
              <span class="bp-metric-label">Net Annual Income</span>
              <span id="bp-ab-net" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric bp-metric-yield">
              <span class="bp-metric-label">Gross Yield</span>
              <span id="bp-ab-gross-yield" class="bp-metric-value">-</span>
            </div>
            <div class="bp-metric bp-metric-yield">
              <span class="bp-metric-label">Net Yield</span>
              <span id="bp-ab-net-yield" class="bp-metric-value highlight">-</span>
            </div>
          </div>
        </div>
      </div>

      <div class="bp-verdict">
        <h4>Recommendation</h4>
        <p id="bp-recommendation">-</p>
      </div>

      <div class="bp-section-divider"></div>

      <div class="bp-projection">
        <h3>10-Year Projection</h3>

        <div class="bp-projection-inputs">
          <div class="bp-input-group">
            <label for="bp-appreciation">Annual Appreciation (%)</label>
            <input type="number" id="bp-appreciation" value="5" min="0" max="15" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-rent-increase">Annual Rent Increase (%)</label>
            <input type="number" id="bp-rent-increase" value="6" min="0" max="15" step="0.5">
          </div>
        </div>

        <div class="bp-chart-container">
          <canvas id="bp-chart"></canvas>
        </div>

        <div class="bp-breakeven">
          <div class="bp-breakeven-item">
            <span class="bp-breakeven-label">Break-even (Long-Term)</span>
            <span id="bp-breakeven-lt" class="bp-breakeven-value">-</span>
          </div>
          <div class="bp-breakeven-item">
            <span class="bp-breakeven-label">Break-even (Airbnb)</span>
            <span id="bp-breakeven-ab" class="bp-breakeven-value">-</span>
          </div>
        </div>

        <div class="bp-projection-summary">
          <h4>After 10 Years</h4>
          <div class="bp-projection-grid">
            <div class="bp-projection-card lt">
              <span class="bp-projection-label">Long-Term Total Profit</span>
              <span id="bp-10y-lt-profit" class="bp-projection-value">-</span>
            </div>
            <div class="bp-projection-card ab">
              <span class="bp-projection-label">Airbnb Total Profit</span>
              <span id="bp-10y-ab-profit" class="bp-projection-value">-</span>
            </div>
          </div>
        </div>
      </div>

      <div class="bp-section-divider"></div>

      <div class="bp-taxes">
        <h3>All Taxes & Fees (Non-Resident)</h3>

        <div class="bp-taxes-section">
          <h4>Acquisition Costs (One-Time)</h4>
          <div class="bp-tax-item">
            <span>Transfer Duty</span>
            <span id="bp-tax-transfer">-</span>
          </div>
          <div class="bp-tax-item">
            <span>Conveyancing & Deeds</span>
            <span id="bp-tax-convey">~R45,000</span>
          </div>
          <div class="bp-tax-item total">
            <span>Total Acquisition</span>
            <span id="bp-tax-acq-total">-</span>
          </div>
        </div>

        <div class="bp-taxes-section">
          <h4>Annual Taxes</h4>
          <div class="bp-tax-item">
            <span>Municipal Rates (0.72%)</span>
            <span id="bp-tax-rates">-</span>
          </div>
          <div class="bp-tax-item">
            <span>Rental Income Tax (~25% effective)</span>
            <span id="bp-tax-income">-</span>
          </div>
        </div>

        <div class="bp-taxes-section">
          <h4>Sale Costs (If Selling After 10Y)</h4>
          <div class="bp-tax-item">
            <span>Agent Commission (7%+VAT)</span>
            <span id="bp-tax-agent">-</span>
          </div>
          <div class="bp-tax-item">
            <span>CGT (~18% on gain)</span>
            <span id="bp-tax-cgt">-</span>
          </div>
          <div class="bp-tax-item">
            <span>Non-Resident Withholding (7.5%)</span>
            <span id="bp-tax-withhold">-</span>
          </div>
        </div>

        <div class="bp-taxes-note">
          <strong>France-SA Tax Treaty:</strong> Rental income taxed in SA first.
          Credit available against French taxes to avoid double taxation.
          Consult a cross-border tax advisor for your specific situation.
        </div>
      </div>

      <div class="bp-footer">
        <small>Estimates based on market data. Actual results may vary. Consult a tax professional.</small>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
