<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cape Town Property Investment</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%231a1a1a'/><rect x='5' y='18' width='6' height='10' fill='%235B7FA6'/><rect x='13' y='12' width='6' height='16' fill='%23C4834A'/><rect x='21' y='8' width='6' height='20' fill='%235B7FA6' opacity='.7'/><rect x='5' y='27' width='22' height='1.5' fill='%23555'/></svg>">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <h1>CT_INVEST</h1>
    <span class="header-subtitle">Non-Resident Property Analysis</span>
    <div class="header-live">LIVE DATA</div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">
    <!-- LEFT: Map Panel with padding -->
    <aside class="map-panel">
      <div class="map-wrapper">
        <div id="map"></div>
        <!-- Legend overlay INSIDE the map -->
        <div class="map-legend">
          <h4>Price R/m²</h4>
          <div class="legend-item"><span class="color-box" style="background:#2ECC71"></span><span>24k-35k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#F1C40F"></span><span>35k-50k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#F39C12"></span><span>50k-70k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#E67E22"></span><span>70k-100k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#E74C3C"></span><span>100k-140k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#8E44AD"></span><span>140k+</span></div>
        </div>
      </div>
      <p class="map-instructions">Click a zone to filter listings</p>
    </aside>

    <!-- RIGHT: Content Area -->
    <main class="content-area">
      <!-- TABS -->
      <nav class="main-tabs">
        <button class="main-tab active" onclick="showTab('all-listings')">All Listings</button>
        <button class="main-tab" onclick="showTab('top-picks')">Top Picks</button>
        <button class="main-tab" onclick="showTab('rankings')">Zone Rankings</button>
      </nav>

      <!-- TAB: Rankings -->
      <section id="tab-rankings" class="tab-content">
        <div class="section-header">
          <div>
            <h2>Investment Rankings</h2>
            <p class="section-subtitle">Top 5 by net yield (35m² apartment)</p>
          </div>
        </div>

        <div class="rankings-grid">
          <div class="ranking-card">
            <h4>Long-Term + Resale</h4>
            <ol id="rank-lt-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Long-Term + New</h4>
            <ol id="rank-lt-new" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + Resale</h4>
            <ol id="rank-ab-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + New</h4>
            <ol id="rank-ab-new" class="ranking-list"></ol>
          </div>
        </div>

        <div class="rankings-note">
          <strong>Note:</strong> Net yield includes all costs (levy, rates, insurance, fees, management).
          Airbnb assumes average occupancy - top performers can achieve higher yields.
        </div>
      </section>

      <!-- TAB: All Listings -->
      <section id="tab-all-listings" class="tab-content active">
        <div class="section-header">
          <div>
            <h2>All Listings</h2>
            <p class="section-subtitle">22 properties from Private Property</p>
          </div>
        </div>

        <div class="listings-filters">
          <div class="filter-group">
            <label>Zone</label>
            <select id="filter-zone" onchange="filterListings()">
              <option value="all">All Zones</option>
              <optgroup label="West Coast">
                <option value="table_view">Table View</option>
                <option value="milnerton">Milnerton</option>
                <option value="big_bay">Big Bay</option>
                <option value="bloubergstrand">Bloubergstrand</option>
              </optgroup>
              <optgroup label="Atlantic Seaboard">
                <option value="sea_point">Sea Point</option>
                <option value="green_point">Green Point</option>
                <option value="mouille_point">Mouille Point</option>
                <option value="three_anchor_bay">Three Anchor Bay</option>
              </optgroup>
              <optgroup label="City Bowl">
                <option value="de_waterkant">De Waterkant</option>
                <option value="bo_kaap">Bo-Kaap</option>
                <option value="cape_town_city_centre">City Centre</option>
                <option value="zonnebloem">Zonnebloem</option>
              </optgroup>
              <optgroup label="City Bowl Upper">
                <option value="gardens">Gardens</option>
                <option value="tamboerskloof">Tamboerskloof</option>
                <option value="vredehoek">Vredehoek</option>
              </optgroup>
              <optgroup label="Eastern">
                <option value="woodstock">Woodstock</option>
                <option value="observatory">Observatory</option>
                <option value="salt_river">Salt River</option>
              </optgroup>
              <optgroup label="Southern Suburbs">
                <option value="claremont">Claremont</option>
                <option value="rondebosch">Rondebosch</option>
              </optgroup>
            </select>
          </div>
          <div class="filter-group">
            <label>Max Price</label>
            <select id="filter-price" onchange="filterListings()">
              <option value="999999999">Any</option>
              <option value="1500000">Under R1.5M</option>
              <option value="2000000">Under R2M</option>
              <option value="3000000">Under R3M</option>
              <option value="5000000">Under R5M</option>
              <option value="10000000">Under R10M</option>
              <option value="15000000">Under R15M</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Bedrooms</label>
            <select id="filter-beds" onchange="filterListings()">
              <option value="all">Any</option>
              <option value="0">Studio</option>
              <option value="1">1 Bed</option>
              <option value="2">2 Bed</option>
            </select>
          </div>
        </div>

        <div id="all-listings-grid" class="listings-grid"></div>
      </section>

      <!-- TAB: Top Picks -->
      <section id="tab-top-picks" class="tab-content">
        <div class="section-header">
          <div>
            <h2>Top Picks</h2>
            <p class="section-subtitle">Curated selection — best yield/price ratio</p>
          </div>
        </div>
        <div id="top-picks-grid" class="listings-grid"></div>
      </section>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    Data: The Africanvestor, Private Property, Lightstone, Airbnb (Feb 2026)
  </footer>

  <!-- BP Modal - Compact Grid Layout -->
  <div id="bp-modal" class="bp-modal">
    <div class="bp-modal-content">
      <button class="bp-close" onclick="closeBPModal()">&times;</button>

      <div class="bp-grid">
        <div class="bp-header">
          <h2 id="bp-title">Business Plan</h2>
          <span id="bp-zone" class="bp-zone-badge"></span>
        </div>

        <div class="bp-inputs">
          <div class="bp-input-group">
            <label for="bp-size">Size (m²)</label>
            <input type="number" id="bp-size" value="35" min="15" max="200" step="5">
          </div>
          <div class="bp-input-group">
            <label>Type</label>
            <div class="bp-toggle">
              <button id="btn-resale" class="bp-toggle-btn active" onclick="setPurchaseType('resale')">Resale</button>
              <button id="btn-new" class="bp-toggle-btn" onclick="setPurchaseType('new')">New</button>
            </div>
          </div>
          <div class="bp-input-group">
            <label for="bp-appreciation">Appreciation %</label>
            <input type="number" id="bp-appreciation" value="5" min="0" max="15" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-rent-increase">Rent Increase %</label>
            <input type="number" id="bp-rent-increase" value="6" min="0" max="15" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-ltv">Loan LTV %</label>
            <input type="number" id="bp-ltv" value="0" min="0" max="80" step="5">
          </div>
          <div class="bp-input-group">
            <label for="bp-rate">Interest Rate %</label>
            <input type="number" id="bp-rate" value="11" min="5" max="20" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-price-override">R/m² override</label>
            <input type="number" id="bp-price-override" placeholder="auto" min="5000" max="300000" step="500">
          </div>
        </div>

        <div class="bp-summary">
          <div class="bp-summary-item">
            <span class="bp-summary-label">Purchase Price</span>
            <span id="bp-purchase-price" class="bp-summary-value">-</span>
          </div>
          <div class="bp-summary-item">
            <span class="bp-summary-label">+ Acquisition Costs</span>
            <span id="bp-tax-acq-total" class="bp-summary-value">-</span>
          </div>
          <div class="bp-summary-item">
            <span class="bp-summary-label">Price/m²</span>
            <span id="bp-price-sqm" class="bp-summary-value">-</span>
          </div>
          <button class="bp-recompute-btn" onclick="recomputeBP()">↻ Recompute BP</button>
        </div>

        <div class="bp-comparison">
          <div class="bp-column bp-longterm">
            <div class="bp-column-header"><h3>Long-Term</h3></div>
            <div class="bp-metrics">
              <div class="bp-metric">
                <span class="bp-metric-label">Rent/m²/mo <span class="bp-inline-param">R<input type="number" id="bp-lt-rent-input" class="bp-inline-input" style="width:42px" min="50" max="1000" step="10"></span></span>
                <span id="bp-lt-rent" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Annual Revenue <span class="bp-inline-param"><input type="number" id="bp-lt-occupancy" class="bp-inline-input" min="50" max="100" step="1">% occ.</span></span>
                <span id="bp-lt-annual" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Body Corporate <span class="bp-inline-param">R<input type="number" id="bp-lt-levy-rate" class="bp-inline-input" style="width:34px" min="10" max="200" step="5">/m²</span></span>
                <span id="bp-lt-levy" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Rates & Insurance</span>
                <span id="bp-lt-rates" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Maintenance <span class="bp-inline-param"><input type="number" id="bp-lt-maintenance-rate" class="bp-inline-input" min="0" max="20" step="0.5">%</span></span>
                <span id="bp-lt-maintenance" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub" id="bp-lt-mortgage-row" style="display:none">
                <span class="bp-metric-label">Mortgage (20yr)</span>
                <span id="bp-lt-mortgage" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Income Tax (25%)</span>
                <span id="bp-lt-tax" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-highlight">
                <span class="bp-metric-label">Net Operating Income</span>
                <span id="bp-lt-net" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Net Yield</span>
                <span id="bp-lt-net-yield" class="bp-metric-value highlight">-</span>
              </div>
            </div>
          </div>

          <div class="bp-column bp-airbnb">
            <div class="bp-column-header"><h3>Airbnb <span id="bp-ab-occupancy-header" class="bp-occupancy-badge">55% occ.</span></h3></div>
            <div class="bp-metrics">
              <div class="bp-metric">
                <span class="bp-metric-label">Nightly Rate <span class="bp-inline-param">R<input type="number" id="bp-ab-nightly-input" class="bp-inline-input" style="width:50px" min="100" max="20000" step="50">/night</span></span>
                <span id="bp-ab-nightly" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Annual Revenue <span class="bp-inline-param"><input type="number" id="bp-ab-occupancy-input" class="bp-inline-input" min="10" max="100" step="1">% occ.</span></span>
                <span id="bp-ab-annual" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Platform Fees <span class="bp-inline-param"><input type="number" id="bp-ab-fees-rate" class="bp-inline-input" min="0" max="30" step="0.5">%</span></span>
                <span id="bp-ab-fees" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Cleaning, Utils & Maint. <span class="bp-inline-param"><input type="number" id="bp-ab-maintenance-rate" class="bp-inline-input" min="0" max="20" step="0.5">% maint.</span></span>
                <span id="bp-ab-cleaning" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Management <span class="bp-inline-param"><input type="number" id="bp-ab-mgmt-rate" class="bp-inline-input" min="0" max="40" step="1">%</span></span>
                <span id="bp-ab-management" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub" id="bp-ab-mortgage-row" style="display:none">
                <span class="bp-metric-label">Mortgage (20yr)</span>
                <span id="bp-ab-mortgage" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Income Tax (25%)</span>
                <span id="bp-ab-tax" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-highlight">
                <span class="bp-metric-label">Net Operating Income</span>
                <span id="bp-ab-net" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Net Yield</span>
                <span id="bp-ab-net-yield" class="bp-metric-value highlight">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="bp-verdict">
          <h4>Recommendation</h4>
          <p id="bp-recommendation">-</p>
        </div>

        <div class="bp-projection">
          <h3>10-Year Projection (if sold)</h3>
          <div class="bp-chart-container">
            <canvas id="bp-chart"></canvas>
          </div>
          <div class="bp-projection-right">
            <div class="bp-breakeven">
              <div class="bp-breakeven-item">
                <span class="bp-breakeven-label">Break-even LT</span>
                <span id="bp-breakeven-lt" class="bp-breakeven-value">-</span>
              </div>
              <div class="bp-breakeven-item">
                <span class="bp-breakeven-label">Break-even AB</span>
                <span id="bp-breakeven-ab" class="bp-breakeven-value">-</span>
              </div>
            </div>
            <div class="bp-projection-summary">
              <h4>Total Profit After 10Y</h4>
              <div class="bp-projection-grid">
                <div class="bp-projection-card lt">
                  <span class="bp-projection-label">Long-Term</span>
                  <span id="bp-10y-lt-profit" class="bp-projection-value">-</span>
                </div>
                <div class="bp-projection-card ab">
                  <span class="bp-projection-label">Airbnb</span>
                  <span id="bp-10y-ab-profit" class="bp-projection-value">-</span>
                </div>
              </div>
            </div>
            <div id="bp-listing-cta" style="display:none">
              <a id="bp-listing-url" href="#" target="_blank" class="bp-cta-btn">View on Private Property →</a>
            </div>
          </div>
        </div>

        <div class="bp-taxes">
          <h3>Taxes & Fees (Non-Resident)</h3>
          <div class="bp-taxes-grid">
            <div class="bp-taxes-section">
              <h4>Acquisition</h4>
              <div class="bp-tax-item">
                <span>Transfer Duty</span>
                <span id="bp-tax-transfer">-</span>
              </div>
              <div class="bp-tax-item">
                <span>Conveyancing</span>
                <span id="bp-tax-convey">~R45k</span>
              </div>
            </div>
            <div class="bp-taxes-section">
              <h4>Annual</h4>
              <div class="bp-tax-item">
                <span>Rates (0.72%)</span>
                <span id="bp-tax-rates">-</span>
              </div>
              <div class="bp-tax-item">
                <span>Income Tax (~25%)</span>
                <span id="bp-tax-income">-</span>
              </div>
            </div>
            <div class="bp-taxes-section">
              <h4>Sale (10Y)</h4>
              <div class="bp-tax-item">
                <span>Agent (8%)</span>
                <span id="bp-tax-agent">-</span>
              </div>
              <div class="bp-tax-item">
                <span>CGT (~18%)</span>
                <span id="bp-tax-cgt">-</span>
              </div>
            </div>
            <div class="bp-taxes-note">
              <strong>Note:</strong> France-SA treaty avoids double taxation. Consult a tax advisor.
            </div>
          </div>
        </div>

        <div class="bp-footer">
          Estimates only. Consult professionals before investing.
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
