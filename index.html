<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cape Town Property Investment</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%231a1a1a'/><rect x='5' y='18' width='6' height='10' fill='%235B7FA6'/><rect x='13' y='12' width='6' height='16' fill='%23C4834A'/><rect x='21' y='8' width='6' height='20' fill='%235B7FA6' opacity='.7'/><rect x='5' y='27' width='22' height='1.5' fill='%23555'/></svg>">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <h1>CT_INVEST</h1>
    <span class="header-subtitle">Non-Resident Property Analysis</span>
    <div class="header-live">LIVE DATA</div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">
    <!-- LEFT: Map Panel with padding -->
    <aside class="map-panel">
      <div class="map-wrapper">
        <div id="map"></div>
        <!-- Legend overlay INSIDE the map -->
        <div class="map-legend">
          <h4>Price R/m¬≤</h4>
          <div class="legend-item"><span class="color-box" style="background:#2ECC71"></span><span>24k-35k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#F1C40F"></span><span>35k-50k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#F39C12"></span><span>50k-70k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#E67E22"></span><span>70k-100k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#E74C3C"></span><span>100k-140k</span></div>
          <div class="legend-item"><span class="color-box" style="background:#8E44AD"></span><span>140k+</span></div>
        </div>
      </div>
      <p class="map-instructions">Click a zone to analyze</p>
    </aside>

    <!-- RIGHT: Content Area -->
    <main class="content-area">
      <!-- TABS -->
      <nav class="main-tabs">
        <button class="main-tab active" onclick="showTab('zone')">Zone Info</button>
        <button class="main-tab" onclick="showTab('rankings')">Zone Rankings</button>
        <button class="main-tab" onclick="showTab('all-listings')">All Listings</button>
        <button class="main-tab" onclick="showTab('topics')">Topics</button>
      </nav>

      <!-- TAB: Selected Zone -->
      <section id="tab-zone" class="tab-content active">
        <div class="zone-header">
          <h2 id="zone-title">Select a zone</h2>
          <div id="zone-badges" class="zone-badges"></div>
        </div>

        <div id="zone-stats" class="zone-stats">
          <p class="zone-instruction">Click on a neighborhood in the map to see price data, rental yields, and available listings.</p>
        </div>

        <div id="zone-price-info" class="zone-price-grid"></div>

        <div id="zone-listings" class="listings-grid"></div>
      </section>

      <!-- TAB: Rankings -->
      <section id="tab-rankings" class="tab-content">
        <div class="section-header">
          <div>
            <h2>Investment Rankings</h2>
            <p class="section-subtitle">Top 5 by net yield (35m¬≤ apartment)</p>
          </div>
        </div>

        <div class="rankings-grid">
          <div class="ranking-card">
            <h4>Long-Term + Resale</h4>
            <ol id="rank-lt-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Long-Term + New</h4>
            <ol id="rank-lt-new" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + Resale</h4>
            <ol id="rank-ab-resale" class="ranking-list"></ol>
          </div>
          <div class="ranking-card">
            <h4>Airbnb + New</h4>
            <ol id="rank-ab-new" class="ranking-list"></ol>
          </div>
        </div>

        <div class="rankings-note">
          <strong>Note:</strong> Net yield includes all costs (levy, rates, insurance, fees, management).
          Airbnb assumes average occupancy - top performers can achieve higher yields.
        </div>
      </section>

      <!-- TAB: All Listings -->
      <section id="tab-all-listings" class="tab-content">
        <div class="section-header">
          <div>
            <h2>All Listings</h2>
            <p class="section-subtitle">22 properties from Private Property</p>
          </div>
        </div>

        <div class="listings-filters">
          <div class="filter-group">
            <label>Zone</label>
            <select id="filter-zone" onchange="filterListings()">
              <option value="all">All Zones</option>
              <option value="table_view">Table View</option>
              <option value="milnerton">Milnerton</option>
              <option value="big_bay">Big Bay</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Max Price</label>
            <select id="filter-price" onchange="filterListings()">
              <option value="999999999">Any</option>
              <option value="1000000">Under R1M</option>
              <option value="1250000">Under R1.25M</option>
              <option value="1500000">Under R1.5M</option>
              <option value="2000000">Under R2M</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Bedrooms</label>
            <select id="filter-beds" onchange="filterListings()">
              <option value="all">Any</option>
              <option value="1">1 Bed</option>
              <option value="2">2 Bed</option>
            </select>
          </div>
        </div>

        <div id="all-listings-grid" class="listings-grid"></div>
      </section>

      <!-- TAB: Topics -->
      <section id="tab-topics" class="tab-content">
        <div class="section-header">
          <div>
            <h2>Topics</h2>
            <p class="section-subtitle">Key considerations for non-resident investors</p>
          </div>
        </div>
        <div class="topics-grid">

          <div class="topic-card">
            <div class="topic-icon">üè¶</div>
            <h3>Financing</h3>
            <ul>
              <li>Non-residents can access SA mortgages ‚Äî typically <strong>50% LTV max</strong></li>
              <li>Interest rates currently ~<strong>11‚Äì11.5%</strong> (prime rate)</li>
              <li>Loan term: up to 20 years</li>
              <li>SA banks require foreign income proof + SA bank account</li>
              <li>No mortgage ‚Üí full cash purchase, higher yield</li>
            </ul>
          </div>

          <div class="topic-card">
            <div class="topic-icon">üßæ</div>
            <h3>Taxes for Non-Residents</h3>
            <ul>
              <li><strong>Transfer duty</strong>: 0% under R1.21M, 3% up to R1.66M, escalating above</li>
              <li><strong>Conveyancing</strong>: ~R45 000 fixed</li>
              <li><strong>Rental income tax</strong>: ~25% effective (after deductions)</li>
              <li><strong>France‚ÄìSA treaty</strong>: avoids double taxation</li>
              <li><strong>CGT on sale</strong>: ~18% on capital gain (40% inclusion √ó 45% marginal)</li>
              <li><strong>Agent commission on sale</strong>: ~8% of sale price</li>
            </ul>
          </div>

          <div class="topic-card">
            <div class="topic-icon">üè†</div>
            <h3>Airbnb Regulations</h3>
            <ul>
              <li>Cape Town allows short-term rentals ‚Äî no blanket ban</li>
              <li>Some buildings have HOA rules restricting Airbnb ‚Äî check body corporate rules</li>
              <li>City Bowl / Sea Point: high tourist demand year-round</li>
              <li>West Coast / Blouberg: kite season (Nov‚ÄìMar) drives premium rates</li>
              <li><strong>Management fee</strong>: 15‚Äì25% of revenue (local co-host)</li>
              <li>Platform fees: ~15% (Airbnb) or ~12% (direct)</li>
            </ul>
          </div>

          <div class="topic-card">
            <div class="topic-icon">üìã</div>
            <h3>Buying Process</h3>
            <ul>
              <li>Make an offer ‚Üí OTP (Offer to Purchase) signed by both parties</li>
              <li>Conveyancer appointed (by seller) ‚Äî ~6‚Äì8 weeks to transfer</li>
              <li>SA bank account needed for transfer and ongoing costs</li>
              <li>Foreign capital must be declared to SARB (South African Reserve Bank)</li>
              <li>Repatriation of funds: possible but requires proof of origin</li>
              <li>No restriction on foreign ownership of SA property</li>
            </ul>
          </div>

          <div class="topic-card">
            <div class="topic-icon">üìä</div>
            <h3>Market Context</h3>
            <ul>
              <li>ZAR currently weak vs EUR (~R20/‚Ç¨1) ‚Üí entry prices look cheap in euros</li>
              <li>Cape Town prices: <strong>+5‚Äì8%/yr</strong> historically (City Bowl outperforms)</li>
              <li>Rental demand strong: UCT, expats, digital nomads, corporate</li>
              <li>Studios/micros: highest Airbnb yields but more management intensive</li>
              <li>2-beds: better long-term tenants, lower yield but hands-off</li>
            </ul>
          </div>

          <div class="topic-card">
            <div class="topic-icon">‚ö†Ô∏è</div>
            <h3>Risks</h3>
            <ul>
              <li><strong>Load shedding</strong>: power cuts affect tenant satisfaction ‚Äî check if building has backup power</li>
              <li><strong>Body corporate fees</strong>: can rise significantly in older buildings</li>
              <li><strong>Vacancy risk</strong>: Airbnb occupancy can drop off-season</li>
              <li><strong>Currency risk</strong>: ZAR depreciation reduces EUR returns over time</li>
              <li><strong>Legislative risk</strong>: future Airbnb restrictions possible</li>
              <li>All estimates are indicative ‚Äî consult a local property attorney</li>
            </ul>
          </div>

        </div>
      </section>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    Data: The Africanvestor, Private Property, Lightstone, Airbnb (Feb 2026)
  </footer>

  <!-- BP Modal - Compact Grid Layout -->
  <div id="bp-modal" class="bp-modal">
    <div class="bp-modal-content">
      <button class="bp-close" onclick="closeBPModal()">&times;</button>

      <div class="bp-grid">
        <div class="bp-header">
          <h2 id="bp-title">Business Plan</h2>
          <span id="bp-zone" class="bp-zone-badge"></span>
        </div>

        <div class="bp-inputs">
          <div class="bp-input-group">
            <label for="bp-size">Size (m¬≤)</label>
            <input type="number" id="bp-size" value="35" min="15" max="200" step="5">
          </div>
          <div class="bp-input-group">
            <label>Type</label>
            <div class="bp-toggle">
              <button id="btn-resale" class="bp-toggle-btn active" onclick="setPurchaseType('resale')">Resale</button>
              <button id="btn-new" class="bp-toggle-btn" onclick="setPurchaseType('new')">New</button>
            </div>
          </div>
          <div class="bp-input-group">
            <label for="bp-appreciation">Appreciation %</label>
            <input type="number" id="bp-appreciation" value="5" min="0" max="15" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-rent-increase">Rent Increase %</label>
            <input type="number" id="bp-rent-increase" value="6" min="0" max="15" step="0.5">
          </div>
          <div class="bp-input-group">
            <label for="bp-ltv">Loan LTV %</label>
            <input type="number" id="bp-ltv" value="0" min="0" max="80" step="5">
          </div>
          <div class="bp-input-group">
            <label for="bp-rate">Interest Rate %</label>
            <input type="number" id="bp-rate" value="11" min="5" max="20" step="0.5">
          </div>
        </div>

        <div class="bp-summary">
          <div class="bp-summary-item">
            <span class="bp-summary-label">Purchase Price</span>
            <span id="bp-purchase-price" class="bp-summary-value">-</span>
          </div>
          <div class="bp-summary-item">
            <span class="bp-summary-label">+ Acquisition Costs</span>
            <span id="bp-tax-acq-total" class="bp-summary-value">-</span>
          </div>
          <div class="bp-summary-item">
            <span class="bp-summary-label">Price/m¬≤</span>
            <span id="bp-price-sqm" class="bp-summary-value">-</span>
          </div>
        </div>

        <div class="bp-comparison">
          <div class="bp-column bp-longterm">
            <div class="bp-column-header"><h3>Long-Term</h3></div>
            <div class="bp-metrics">
              <div class="bp-metric">
                <span class="bp-metric-label">Monthly Rent</span>
                <span id="bp-lt-rent" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Annual Revenue</span>
                <span id="bp-lt-annual" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Body Corporate</span>
                <span id="bp-lt-levy" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Rates & Insurance</span>
                <span id="bp-lt-rates" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Maintenance</span>
                <span id="bp-lt-maintenance" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub" id="bp-lt-mortgage-row" style="display:none">
                <span class="bp-metric-label">Mortgage (20yr)</span>
                <span id="bp-lt-mortgage" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Income Tax (25%)</span>
                <span id="bp-lt-tax" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-highlight">
                <span class="bp-metric-label">Net Annual</span>
                <span id="bp-lt-net" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Net Yield</span>
                <span id="bp-lt-net-yield" class="bp-metric-value highlight">-</span>
              </div>
            </div>
          </div>

          <div class="bp-column bp-airbnb">
            <div class="bp-column-header"><h3>Airbnb <span id="bp-ab-occupancy-header" class="bp-occupancy-badge">55% occ.</span></h3></div>
            <div class="bp-metrics">
              <div class="bp-metric">
                <span class="bp-metric-label">Nightly Rate</span>
                <span id="bp-ab-nightly" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Annual Revenue (<span id="bp-ab-occupancy">-</span>%)</span>
                <span id="bp-ab-annual" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Platform Fees</span>
                <span id="bp-ab-fees" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Cleaning & Utilities</span>
                <span id="bp-ab-cleaning" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Management 20%</span>
                <span id="bp-ab-management" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub" id="bp-ab-mortgage-row" style="display:none">
                <span class="bp-metric-label">Mortgage (20yr)</span>
                <span id="bp-ab-mortgage" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-sub">
                <span class="bp-metric-label">Income Tax (25%)</span>
                <span id="bp-ab-tax" class="bp-metric-value expense">-</span>
              </div>
              <div class="bp-metric bp-metric-highlight">
                <span class="bp-metric-label">Net Annual</span>
                <span id="bp-ab-net" class="bp-metric-value">-</span>
              </div>
              <div class="bp-metric">
                <span class="bp-metric-label">Net Yield</span>
                <span id="bp-ab-net-yield" class="bp-metric-value highlight">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="bp-verdict">
          <h4>Recommendation</h4>
          <p id="bp-recommendation">-</p>
        </div>

        <div class="bp-projection">
          <h3>10-Year Projection (if sold)</h3>
          <div class="bp-chart-container">
            <canvas id="bp-chart"></canvas>
          </div>
          <div class="bp-projection-right">
            <div class="bp-breakeven">
              <div class="bp-breakeven-item">
                <span class="bp-breakeven-label">Break-even LT</span>
                <span id="bp-breakeven-lt" class="bp-breakeven-value">-</span>
              </div>
              <div class="bp-breakeven-item">
                <span class="bp-breakeven-label">Break-even AB</span>
                <span id="bp-breakeven-ab" class="bp-breakeven-value">-</span>
              </div>
            </div>
            <div class="bp-projection-summary">
              <h4>Total Profit After 10Y</h4>
              <div class="bp-projection-grid">
                <div class="bp-projection-card lt">
                  <span class="bp-projection-label">Long-Term</span>
                  <span id="bp-10y-lt-profit" class="bp-projection-value">-</span>
                </div>
                <div class="bp-projection-card ab">
                  <span class="bp-projection-label">Airbnb</span>
                  <span id="bp-10y-ab-profit" class="bp-projection-value">-</span>
                </div>
              </div>
            </div>
            <div id="bp-listing-cta" style="display:none">
              <a id="bp-listing-url" href="#" target="_blank" class="bp-cta-btn">View on Private Property ‚Üí</a>
            </div>
          </div>
        </div>

        <div class="bp-taxes">
          <h3>Taxes & Fees (Non-Resident)</h3>
          <div class="bp-taxes-grid">
            <div class="bp-taxes-section">
              <h4>Acquisition</h4>
              <div class="bp-tax-item">
                <span>Transfer Duty</span>
                <span id="bp-tax-transfer">-</span>
              </div>
              <div class="bp-tax-item">
                <span>Conveyancing</span>
                <span id="bp-tax-convey">~R45k</span>
              </div>
            </div>
            <div class="bp-taxes-section">
              <h4>Annual</h4>
              <div class="bp-tax-item">
                <span>Rates (0.72%)</span>
                <span id="bp-tax-rates">-</span>
              </div>
              <div class="bp-tax-item">
                <span>Income Tax (~25%)</span>
                <span id="bp-tax-income">-</span>
              </div>
            </div>
            <div class="bp-taxes-section">
              <h4>Sale (10Y)</h4>
              <div class="bp-tax-item">
                <span>Agent (8%)</span>
                <span id="bp-tax-agent">-</span>
              </div>
              <div class="bp-tax-item">
                <span>CGT (~18%)</span>
                <span id="bp-tax-cgt">-</span>
              </div>
            </div>
            <div class="bp-taxes-note">
              <strong>Note:</strong> France-SA treaty avoids double taxation. Consult a tax advisor.
            </div>
          </div>
        </div>

        <div class="bp-footer">
          Estimates only. Consult professionals before investing.
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
